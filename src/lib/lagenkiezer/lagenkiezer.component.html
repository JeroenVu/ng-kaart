<div class="lagen-lijst kaart-widget" *ngIf="(opties$ | async) as opties">
  <div class="lagen-header" (click)="toggleDichtgeklapt()" [matTooltip]="isOpengeklapt ? 'Verberg lagen' : 'Toon lagen'">
    <button mat-icon-button>
      <mat-icon>layers</mat-icon>
    </button>
    <span class="lagen-titel">{{ opties.headerTitel }}</span>
    <button mat-icon-button>
      <mat-icon *ngIf="isOpengeklapt">expand_less</mat-icon>
      <mat-icon *ngIf="isDichtgeklapt">expand_more</mat-icon>
    </button>
  </div>
  <div *ngIf="isOpengeklapt" [@enterAnimation]>
    <ng-container *ngIf="opties.toonLegende; then inTabGroep; else zonderTabGroep"></ng-container>
    <ng-template #inTabGroep>
      <mat-tab-group [headerPosition]="'above'">
        <mat-tab label="Legende" *ngIf="opties.toonLegende">
          <ng-container *ngTemplateOutlet="legende"></ng-container>
        </mat-tab>
        <mat-tab label="Lagen">
          <ng-container *ngTemplateOutlet="lagen"></ng-container>
        </mat-tab>
      </mat-tab-group>
    </ng-template>
    <ng-template #zonderTabGroep>
      <ng-container *ngTemplateOutlet="lagen"></ng-container>
    </ng-template>
    <ng-template #lagen>
      <div *ngFor="let laag of (lagenHoog$ | async)" [draggable]="opties.verplaatsbareLagen" (dragstart)="onDragStart($event, laag)" (dragend)="onDragEnd()"
        (drop)="onDrop($event, laag)" (dragover)="onDragOver($event, laag)" (dragenter)="onDragEnter($event, laag)" (dragleave)="onDragLeave($event, laag)"
        [ngClass]="dragStyleClasses(laag)">
        <div awvLaagmanipulatie [laag]="laag"></div>
      </div>
      <div class="divider" *ngIf="heeftDivider$ | async"></div>
      <div *ngFor="let laag of (lagenLaag$ | async)" [draggable]="opties.verplaatsbareLagen" (dragstart)="onDragStart($event, laag)" (dragend)="onDragEnd()"
        (drop)="onDrop($event, laag)" (dragover)="onDragOver($event, laag)" (dragenter)="onDragEnter($event, laag)" (dragleave)="onDragLeave($event, laag)"
        [ngClass]="dragStyleClasses(laag)">
        <div awvLaagmanipulatie [laag]="laag"></div>
      </div>
      <div class="geen-lagen" *ngIf="geenLagen$ | async">Er zijn geen voorgrondlagen</div>
    </ng-template>
    <ng-template #legende>
      <div *ngFor="let laag of (lagenMetLegende$ | async)" class="legende">
        <div class="laag">
          <div class="laag-naam">{{laag.titel}}</div>
        </div>
        <div *ngFor="let item of laag.legende.toUndefined().items" class="legende-item">
          <span class="legende-icoon" [innerHtml]="icoon(item)"></span>
          <span class="legende-naam">{{item.beschrijving}}</span>
        </div>
      </div>
      <div class="geen-lagen" *ngIf="geenLegende$ | async">Er zijn geen zichtbare lagen met een legende</div>
    </ng-template>
  </div>
</div>
